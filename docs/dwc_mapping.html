<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lien Reyserhove" />
<meta name="author" content="Peter Desmet" />
<meta name="author" content="Quentin Groom" />

<meta name="date" content="2025-12-14" />

<title>Darwin Core mapping</title>

<script src="site_libs/header-attrs-2.30/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="static/css/trias.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">alien-plants-belgium</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="dwc_mapping.html">Darwin Core mapping</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/trias-project/alien-plants-belgium">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Darwin Core mapping</h1>
<h3 class="subtitle">For: Manual of the Alien Plants of Belgium</h3>
<h4 class="author">Lien Reyserhove</h4>
<h4 class="author">Peter Desmet</h4>
<h4 class="author">Quentin Groom</h4>
<h4 class="date">2025-12-14</h4>

</div>


<p>This document describes how we map the checklist data to Darwin
Core.</p>
<p>Load libraries:</p>
<pre class="r"><code>library(tidyverse)
library(here)
library(janitor)
library(readxl)
library(digest)</code></pre>
<div id="read-source-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Read source data</h1>
<p>The source data is maintained as an Excel file elsewhere. It is
manually copied to this repository.</p>
<p>Read source data:</p>
<pre class="r"><code>raw_data &lt;- read_excel(path = here(&quot;data&quot;, &quot;raw&quot;, &quot;checklist.xlsx&quot;)) </code></pre>
<p>Preview raw data:</p>
<pre class="r"><code>glimpse(raw_data)</code></pre>
<pre><code>## Rows: 2,617
## Columns: 18
## $ Id                             &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, …
## $ Taxon                          &lt;chr&gt; &quot;Acanthus hungaricus (Borbás) Baen.&quot;, &quot;…
## $ `Hybrid formula`               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ Synonym                        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ Family                         &lt;chr&gt; &quot;Acanthaceae&quot;, &quot;Acanthaceae&quot;, &quot;Acanthac…
## $ `M/I`                          &lt;chr&gt; &quot;D&quot;, &quot;D&quot;, &quot;D&quot;, &quot;D&quot;, &quot;D&quot;, &quot;D&quot;, &quot;D&quot;, &quot;D&quot;,…
## $ FR                             &lt;chr&gt; &quot;2016&quot;, &quot;1998&quot;, &quot;2016&quot;, &quot;2013&quot;, &quot;1680&quot;,…
## $ MRR                            &lt;chr&gt; &quot;2018&quot;, &quot;2016&quot;, &quot;2018&quot;, &quot;2018&quot;, &quot;N&quot;, &quot;A…
## $ Origin                         &lt;chr&gt; &quot;E&quot;, &quot;E AF&quot;, &quot;E AF AS-Te&quot;, &quot;AF&quot;, &quot;AS-Te…
## $ Presence_Fl                    &lt;chr&gt; &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;,…
## $ Presence_Br                    &lt;chr&gt; &quot;X&quot;, NA, NA, NA, &quot;X&quot;, NA, NA, NA, NA, &quot;…
## $ Presence_Wa                    &lt;chr&gt; NA, &quot;X&quot;, NA, NA, &quot;X&quot;, &quot;X&quot;, NA, NA, NA, …
## $ `D/N`                          &lt;chr&gt; &quot;Cas.&quot;, &quot;Cas.&quot;, &quot;Cas.&quot;, &quot;Cas.&quot;, &quot;Nat.&quot;,…
## $ `V/I`                          &lt;chr&gt; &quot;Hort.&quot;, &quot;Hort.&quot;, &quot;Hort.&quot;, &quot;Hort.&quot;, &quot;Ho…
## $ taxonRank                      &lt;chr&gt; &quot;species&quot;, &quot;species&quot;, &quot;species&quot;, &quot;speci…
## $ scientificNameID               &lt;chr&gt; NA, &quot;http://ipni.org/urn:lsid:ipni.org:…
## $ Habitat                        &lt;chr&gt; &quot;Terrestrial&quot;, &quot;Terrestrial&quot;, &quot;Terrestr…
## $ `Name (excl. author citation)` &lt;chr&gt; &quot;Acanthus hungaricus&quot;, &quot;Acanthus mollis…</code></pre>
</div>
<div id="preprocessing" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Preprocessing</h1>
<div id="add-taxon-ids" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Add Taxon IDs</h2>
<p>To link taxa with information in the extension(s), each taxon needs a
unique and relatively stable <code>taxonID</code>. Here we create one in
the form of <code>dataset_shortname:taxon:hash</code>, where
<code>hash</code> is unique code based on scientific name (not
kingdom).</p>
<pre class="r"><code># Vectorize the digest function (The digest() function isn&#39;t vectorized. So if you pass in a vector, you get one value for the whole vector rather than a digest for each element of the vector):
vdigest &lt;- Vectorize(digest)

input_data &lt;-
  raw_data |&gt;
  remove_empty(&quot;rows&quot;) |&gt;
  clean_names() |&gt;
  mutate(
    taxon_id = paste(
      &quot;alien-plants-belgium&quot;,
      &quot;taxon&quot;,
      vdigest(taxon, algo = &quot;md5&quot;),
      sep = &quot;:&quot;
    )
  )</code></pre>
</div>
<div id="process-distribution-information-adds-rows"
class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Process distribution
information (adds rows)</h2>
<ol style="list-style-type: decimal">
<li><p>Information on the occurrences is given for the
<strong>regions</strong>, while date information is given for
<strong>Belgium</strong> as a whole. Some transformations and
clarifications are needed.</p></li>
<li><p>Some species have two values for <code>occurrenceStatus</code>
and <code>eventDate</code>, i.e. species with the degree of
naturalisation (<code>d_n</code>) of extinct (<code>Ext.</code>) or
extinct/casual (<code>Ext./Cas.</code>).</p></li>
</ol>
<blockquote>
<p>Extinct: introduced taxa that once were naturalized (usually rather
locally) but that have not been confirmed in recent times in their known
localities. Only taxa that are certainly extinct are indicated as such.
Extinct/casual: Some of these extinct taxa are no longer considered as
naturalized but still occur as casuals; such taxa are indicated as
“Ext./Cas.” (for instance <em>Tragopogon porrifolius</em>).</p>
</blockquote>
<p>For these species, we include the occurrenceStatus
<strong>within</strong> the specified time frame (<code>eventDate</code>
= first - most recent observation) and <strong>after</strong> the last
observation (<code>eventDate</code> = most recent observation - current
date).</p>
<p>The easiest way to do use a stepwise approach:</p>
<ol style="list-style-type: decimal">
<li>Clean presence information and date information in
<code>distribution</code></li>
<li>Create a separate dataframe <code>occurrenceStatus_ALO</code> (ALO =
after last observation) for extinct and extinct/casual species</li>
<li>Map <code>occurrenceStatus</code> and <code>eventDate</code> from
cleaned presence and date information in <code>distribution</code> (for
<code>eventDate</code> = first - most recent observation)</li>
<li>Map <code>occurrenceStatus</code> and <code>eventDate</code> from
cleaned presence and date information in
<code>occurrence_status_ALO</code> (for <code>eventDate</code> = most
recent observation - current date)</li>
<li>Bind both dataframes by row.</li>
<li>Map the other Darwin Core terms in the distribution extension</li>
</ol>
<p>The checklist contains minimal presence information
(<code>X</code>,<code>?</code> or <code>NA</code>) for the three regions
in Belgium: Flanders, Wallonia and the Brussels-Capital Region,
contained in <code>presence_fl</code>, <code>presence_wa</code> and
<code>presence_br</code> respectively. Information regarding the
first/last recorded observation applies to the distribution in Belgium
as a whole. Both national and regional information is required in the
checklist. In the <code>distribution.csv</code>, we will first provide
<code>occurrenceStatus</code> and `eventDate`` on a <strong>national
level</strong>, followed by specific information for the
<strong>regions</strong>.</p>
<p>For this, we use the following principles:</p>
<ol style="list-style-type: decimal">
<li><p>When a species is present in <em>only one region</em>, we can
assume <code>eventDate</code> relates to that specific region. In this
case, we can keep lines for Belgium and for the specific region
populated with these variables (see #45).</p></li>
<li><p>When a species is present in <em>more than one</em> region, it is
impossible to extrapolate the date information for the regions. In this
case, we decided to provide <code>occurrenceStatus</code> for the
regional information, and specify dates only for Belgium.</p></li>
</ol>
<p>Thus, we need to specify when a species is present in only one of the
regions.</p>
<p>We generate 4 new columns: <code>flanders</code>,
<code>brussels</code>,<code>wallonia</code> and <code>belgium</code>.
The content of these columns refers to the specific presence status of a
species on a regional or national level. <code>S</code> if present in a
single region or in Belgium, <code>?</code> if presence uncertain,
<code>NA</code> if absent and <code>M</code> if present in multiple
regions.</p>
<p>This should look like this:</p>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["presence_fl"],"name":[1],"type":["chr"],"align":["left"]},{"label":["presence_br"],"name":[2],"type":["chr"],"align":["left"]},{"label":["presence_wa"],"name":[3],"type":["chr"],"align":["left"]},{"label":["flanders"],"name":[4],"type":["chr"],"align":["left"]},{"label":["brussels"],"name":[5],"type":["chr"],"align":["left"]},{"label":["wallonia"],"name":[6],"type":["chr"],"align":["left"]},{"label":["belgium"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"X","2":"NA","3":"NA","4":"S","5":"NA","6":"NA","7":"S","_rn_":"1"},{"1":"NA","2":"X","3":"NA","4":"NA","5":"S","6":"NA","7":"S","_rn_":"2"},{"1":"NA","2":"NA","3":"X","4":"NA","5":"NA","6":"S","7":"S","_rn_":"3"},{"1":"X","2":"X","3":"NA","4":"M","5":"M","6":"NA","7":"S","_rn_":"4"},{"1":"X","2":"NA","3":"X","4":"M","5":"NA","6":"M","7":"S","_rn_":"5"},{"1":"NA","2":"X","3":"X","4":"NA","5":"M","6":"M","7":"S","_rn_":"6"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","_rn_":"7"},{"1":"X","2":"?","3":"NA","4":"S","5":"?","6":"NA","7":"S","_rn_":"8"},{"1":"X","2":"NA","3":"?","4":"S","5":"NA","6":"?","7":"S","_rn_":"9"},{"1":"X","2":"X","3":"?","4":"M","5":"M","6":"?","7":"S","_rn_":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Add location columns:</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  mutate(
    flanders = case_when(
      presence_fl == &quot;X&quot; &amp;
      (is.na(presence_br) | presence_br == &quot;?&quot;) &amp;
      (is.na(presence_wa) | presence_wa == &quot;?&quot;)
        ~ &quot;S&quot;,
      presence_fl == &quot;?&quot; ~ &quot;?&quot;,
      is.na(presence_fl) ~ NA_character_,
      TRUE ~ &quot;M&quot;
    ),
    brussels = case_when(
      (is.na(presence_fl) | presence_fl == &quot;?&quot;) &amp;
      presence_br == &quot;X&quot; &amp;
      (is.na(presence_wa) | presence_wa == &quot;?&quot;)
        ~ &quot;S&quot;,
      presence_br == &quot;?&quot; ~ &quot;?&quot;,
      is.na(presence_br) ~ NA_character_,
      TRUE ~ &quot;M&quot;
    ),
    wallonia = case_when(
      (is.na(presence_fl) | presence_fl == &quot;?&quot;) &amp;
      (is.na(presence_br) | presence_br == &quot;?&quot;) &amp;
      presence_wa == &quot;X&quot;
        ~ &quot;S&quot;,
      presence_wa == &quot;?&quot; ~ &quot;?&quot;,
      is.na(presence_wa) ~ NA_character_,
      TRUE ~ &quot;M&quot;
    ),
    belgium = case_when(
      presence_fl == &quot;X&quot; | presence_br == &quot;X&quot; | presence_wa == &quot;X&quot; ~ &quot;S&quot;, # One is &quot;X&quot;
      presence_fl == &quot;?&quot; | presence_br == &quot;?&quot; | presence_wa == &quot;?&quot; ~ &quot;?&quot; # One is &quot;?&quot;
    )
  )</code></pre>
<p>Summary of the previous action:</p>
<pre class="r"><code>input_data |&gt;
  select(
    presence_fl,
    presence_br,
    presence_wa,
    flanders,
    wallonia,
    brussels,
    belgium) |&gt;
  group_by_all() |&gt;
  summarize(records = n()) |&gt;
  arrange(flanders, wallonia, brussels)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["presence_fl"],"name":[1],"type":["chr"],"align":["left"]},{"label":["presence_br"],"name":[2],"type":["chr"],"align":["left"]},{"label":["presence_wa"],"name":[3],"type":["chr"],"align":["left"]},{"label":["flanders"],"name":[4],"type":["chr"],"align":["left"]},{"label":["wallonia"],"name":[5],"type":["chr"],"align":["left"]},{"label":["brussels"],"name":[6],"type":["chr"],"align":["left"]},{"label":["belgium"],"name":[7],"type":["chr"],"align":["left"]},{"label":["records"],"name":[8],"type":["int"],"align":["right"]}],"data":[{"1":"?","2":"?","3":"?","4":"?","5":"?","6":"?","7":"?","8":"21"},{"1":"?","2":"X","3":"?","4":"?","5":"?","6":"S","7":"S","8":"1"},{"1":"X","2":"?","3":"X","4":"M","5":"M","6":"?","7":"S","8":"5"},{"1":"X","2":"X","3":"X","4":"M","5":"M","6":"M","7":"S","8":"505"},{"1":"X","2":"NA","3":"X","4":"M","5":"M","6":"NA","7":"S","8":"648"},{"1":"X","2":"X","3":"NA","4":"M","5":"NA","6":"M","7":"S","8":"78"},{"1":"X","2":"?","3":"?","4":"S","5":"?","6":"?","7":"S","8":"3"},{"1":"X","2":"NA","3":"?","4":"S","5":"?","6":"NA","7":"S","8":"1"},{"1":"X","2":"NA","3":"NA","4":"S","5":"NA","6":"NA","7":"S","8":"841"},{"1":"NA","2":"X","3":"X","4":"NA","5":"M","6":"M","7":"S","8":"23"},{"1":"NA","2":"NA","3":"X","4":"NA","5":"S","6":"NA","7":"S","8":"455"},{"1":"NA","2":"X","3":"NA","4":"NA","5":"NA","6":"S","7":"S","8":"34"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transform from wide to long (one line per distribution):</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  pivot_longer(
    cols = c(flanders, wallonia, brussels, belgium),
    names_to = &quot;location&quot;,
    values_to = &quot;presence&quot;,
    values_drop_na = FALSE
  ) |&gt;
  # Remove empty presence, but keep at least Belgium (for records without any distribution)
  filter(!is.na(presence) | location == &quot;belgium&quot;)</code></pre>
<p>Now we’ll create and clean a start and end year:</p>
<pre class="r"><code>current_year = format(Sys.Date(), &quot;%Y&quot;)

input_data &lt;-
  input_data |&gt;
  mutate(
    # start_year = first record (fr), end_year = most recent record (mrr)
    # Cleaning strips out ?, ca., &lt; and &gt;
    start_year = str_replace_all(fr, &quot;(\\?|ca. |&lt;|&gt;)&quot;, &quot;&quot;),
    end_year = str_replace_all(mrr, &quot;(\\?|ca. |&lt;|&gt;)&quot;, &quot;&quot;)
  ) |&gt;
  # If end_year = &quot;Ann.&quot; or &quot;N&quot;, use current year
  mutate(
    end_year = case_match(
      end_year,
      &quot;Ann.&quot; ~ current_year,
      &quot;N&quot; ~ current_year,
      .default = end_year
    )
  )</code></pre>
<p>Check if any <code>start_year</code> fall after <code>end_year</code>
(expected to be none):</p>
<pre class="r"><code>input_data |&gt;
  select(start_year, end_year) |&gt;
  mutate(start_year = as.numeric(start_year)) |&gt;
  mutate(end_year = as.numeric(end_year)) |&gt;
  group_by(start_year, end_year) |&gt;
  summarize(records = n()) |&gt;
  filter(start_year &gt; end_year) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["start_year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["end_year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Combine <code>start_year</code> and <code>end_year</code> in an
ranged <code>date</code> (ISO 8601 format). If any those two dates is
empty or the same, we use a single year, as a statement when it was seen
once (either as a first record or a most recent record):</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  mutate(
    date = case_when(
      start_year == &quot;&quot; &amp; end_year == &quot;&quot; ~ &quot;&quot;,
      start_year == &quot;&quot; ~ end_year,
      end_year == &quot;&quot; ~ start_year,
      start_year == end_year ~ start_year,
      TRUE ~ paste(start_year, end_year, sep = &quot;/&quot;)
    )
  )</code></pre>
<p>Then, we map <code>occurrence_status</code> using <a
href="http://www.iucnredlist.org/technical-documents/red-list-training/iucnspatialresources">IUCN
definitions</a> and set <code>event_date</code> only when
<code>presence</code> = <code>S</code>:</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  mutate(
    occurrence_status = case_match(
      presence,
      &quot;S&quot; ~ &quot;present&quot;,
      &quot;M&quot; ~ &quot;present&quot;,
      &quot;?&quot; ~ &quot;presence uncertain&quot;,
      .default = NA_character_
    ),
    event_date = if_else(presence == &quot;S&quot;, date, NA_character_)
  )</code></pre>
<p>Overview of <code>occurrence_status</code> for each location x
presence combination:</p>
<pre class="r"><code>input_data |&gt;
  select (location, presence, occurrence_status) |&gt;
  group_by_all() |&gt;
  summarize(records = n()) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["presence"],"name":[2],"type":["chr"],"align":["left"]},{"label":["occurrence_status"],"name":[3],"type":["chr"],"align":["left"]},{"label":["records"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"belgium","2":"?","3":"presence uncertain","4":"21"},{"1":"belgium","2":"S","3":"present","4":"2594"},{"1":"belgium","2":"NA","3":"NA","4":"2"},{"1":"brussels","2":"?","3":"presence uncertain","4":"29"},{"1":"brussels","2":"M","3":"present","4":"606"},{"1":"brussels","2":"S","3":"present","4":"35"},{"1":"flanders","2":"?","3":"presence uncertain","4":"22"},{"1":"flanders","2":"M","3":"present","4":"1236"},{"1":"flanders","2":"S","3":"present","4":"845"},{"1":"wallonia","2":"?","3":"presence uncertain","4":"26"},{"1":"wallonia","2":"M","3":"present","4":"1181"},{"1":"wallonia","2":"S","3":"present","4":"455"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we create <code>occurrence_status_ALO</code>:</p>
<pre class="r"><code>occurrence_status_ALO &lt;-
  input_data |&gt;
  filter(d_n == &quot;Ext.&quot; | d_n == &quot;Ext./Cas.&quot;)</code></pre>
<p>Map <code>occurrence_status</code> and <code>event_date</code> for
<code>occurrence_status_ALO</code>:</p>
<pre class="r"><code>occurrence_status_ALO &lt;-
  occurrence_status_ALO |&gt;
  mutate(
    occurrence_status = case_when(
      d_n == &quot;Ext.&quot; ~ &quot;absent&quot;,
      d_n == &quot;Ext./Cas.&quot; ~ &quot;present&quot;
    ),
    event_date = if_else(
      presence == &quot;S&quot;,
      paste(end_year, current_year, sep = &quot;/&quot;),
      NA_character_
    )
  )</code></pre>
<p>Bind <code>input_data</code> with <code>occurrence_status_ALO</code>
by rows:</p>
<pre class="r"><code>input_data &lt;- bind_rows(input_data, occurrence_status_ALO)</code></pre>
</div>
<div id="process-pathways-adds-rows" class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Process pathways
(adds rows)</h2>
<p>Pathway information is based on <code>v_i</code>, which contains a
list of introduction pathways (e.g. <code>Agric., wool</code>). We’ll
separate, clean, map and combine these values.</p>
<p>Split <code>v_i</code> on space in 4 columns. In case there are more
than 4 values, these will be merged in native_range_4. The dataset
currently contains no more than 4 values per record.</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  separate(
    v_i,
    into = c(&quot;pathway_1&quot;, &quot;pathway_2&quot;, &quot;pathway_3&quot;, &quot;pathway_4&quot;),
    sep = &quot;,&quot;,
    remove = FALSE,
    convert = FALSE,
    extra = &quot;merge&quot;,
    fill = &quot;right&quot;
  )</code></pre>
<p>Transform from wide to long (one line per distribution +
pathway):</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  pivot_longer(
    cols = c(pathway_1, pathway_2, pathway_3, pathway_4),
    names_to = &quot;pathway_key&quot;,
    values_to = &quot;pathway&quot;,
    values_drop_na = FALSE
  ) |&gt;
  # Remove empty pathways, but keep at least first (for records without any pathway)
  filter(!is.na(pathway) | pathway_key == &quot;pathway_1&quot;)</code></pre>
<p>Map values to <a href="http://rs.tdwg.org/dwc/doc/pw/"
class="uri">http://rs.tdwg.org/dwc/doc/pw/</a>:</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  arrange(id) |&gt; # To see descriptions in order
  mutate(
    pathway = str_replace_all(pathway, &quot;\\?|…|\\.{3}&quot;, &quot;&quot;), # Strip ?, …, ...
    pathway = str_to_lower(pathway), # Convert to lowercase
    pathway = str_trim(pathway) # Clean whitespace
  ) |&gt;
  mutate(
    type = &quot;pathway&quot;,
    mapped_pathway = case_match(
      pathway,
      &quot;agric.&quot; ~ &quot;agriculture&quot;,
      &quot;bird seed&quot; ~ &quot;seedContaminant&quot;,
      &quot;birdseed&quot; ~ &quot;seedContaminant&quot;,
      &quot;bulbs&quot; ~ NA_character_, # horticulture?
      &quot;coconut mats&quot; ~ &quot;seedContaminant&quot;,
      &quot;fish&quot; ~ NA_character_,
      &quot;food refuse&quot; ~ &quot;liveFoodLiveBait&quot;,
      &quot;grain&quot; ~ &quot;seedContaminant&quot;,
      &quot;grain (rice)&quot; ~ &quot;seedContaminant&quot;,
      &quot;grass seed&quot; ~ &quot;seedContaminant&quot;,
      &quot;hay&quot; ~ NA_character_,
      &quot;hort&quot; ~ &quot;horticulture&quot;,
      &quot;hort.&quot; ~ &quot;horticulture&quot;,
      &quot;hybridization&quot; ~ NA_character_,
      &quot;military troops&quot; ~ NA_character_,
      &quot;nurseries&quot; ~ &quot;contaminantNursery&quot;,
      &quot;ore&quot; ~ &quot;transportationHabitatMaterial&quot;,
      &quot;pines&quot; ~ &quot;contaminantOnPlants&quot;, # timberTrade?
      &quot;rice&quot; ~ NA_character_,
      &quot;salt&quot; ~ NA_character_,
      &quot;seeds&quot; ~ &quot;seedContaminant&quot;,
      &quot;timber&quot; ~ &quot;timberTrade&quot;,
      &quot;tourists&quot; ~ &quot;containerBulk&quot;,
      &quot;traffic&quot; ~ NA_character_,
      &quot;unknown&quot; ~ NA_character_,
      &quot;urban weed&quot; ~ &quot;stowaway&quot;, # NA_character_ ?
      &quot;waterfowl&quot; ~ &quot;contaminantOnAnimals&quot;,
      &quot;wool&quot; ~ &quot;contaminantOnAnimals&quot;,
      &quot;wool alien&quot; ~ &quot;contaminantOnAnimals&quot;,
      .default = NA_character_
    )
  )</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>input_data |&gt;
  select(pathway, mapped_pathway) |&gt;
  group_by(pathway, mapped_pathway) |&gt;
  summarize(records = n()) |&gt;
  arrange(pathway)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pathway"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mapped_pathway"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"","2":"NA","3":"1702"},{"1":"agric.","2":"agriculture","3":"303"},{"1":"bird seed","2":"seedContaminant","3":"4"},{"1":"birdseed","2":"seedContaminant","3":"92"},{"1":"bulbs","2":"NA","3":"2"},{"1":"coconut mats","2":"seedContaminant","3":"2"},{"1":"etc.","2":"NA","3":"6"},{"1":"fish","2":"NA","3":"6"},{"1":"food refuse","2":"liveFoodLiveBait","3":"65"},{"1":"grain","2":"seedContaminant","3":"1618"},{"1":"grain (rice)","2":"seedContaminant","3":"9"},{"1":"grass seed","2":"seedContaminant","3":"19"},{"1":"hay","2":"NA","3":"4"},{"1":"hort","2":"horticulture","3":"7"},{"1":"hort.","2":"horticulture","3":"3194"},{"1":"hybridization","2":"NA","3":"135"},{"1":"military troops","2":"NA","3":"22"},{"1":"nurseries","2":"contaminantNursery","3":"59"},{"1":"ore","2":"transportationHabitatMaterial","3":"301"},{"1":"pines","2":"contaminantOnPlants","3":"11"},{"1":"rice","2":"NA","3":"4"},{"1":"salt","2":"NA","3":"6"},{"1":"seeds","2":"seedContaminant","3":"193"},{"1":"timber","2":"timberTrade","3":"29"},{"1":"tourists","2":"containerBulk","3":"32"},{"1":"traffic","2":"NA","3":"12"},{"1":"urban weed","2":"stowaway","3":"32"},{"1":"waterfowl","2":"contaminantOnAnimals","3":"45"},{"1":"wool","2":"contaminantOnAnimals","3":"1567"},{"1":"wool alien","2":"contaminantOnAnimals","3":"2"},{"1":"NA","2":"NA","3":"8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="process-degree-of-establishment" class="section level2"
number="2.4">
<h2><span class="header-section-number">2.4</span> Process degree of
establishment</h2>
<p>The information for degree of establishment is contained in
<code>d_n</code>.</p>
<p>Map values to <a href="http://rs.tdwg.org/dwc/doc/doe/"
class="uri">http://rs.tdwg.org/dwc/doc/doe/</a>:</p>
<pre class="r"><code>input_data &lt;-
  input_data |&gt;
  arrange(id) |&gt; # To see descriptions in order
  mutate(
    degree_of_establishment = case_match(
      d_n,
      &quot;Ext.&quot; ~ NA_character_,
      &quot;Ext.?&quot; ~ NA_character_,
      &quot;Ext./Cas.&quot; ~ &quot;casual&quot;,
      &quot;Cas.&quot; ~ &quot;casual&quot;,
      &quot;Cas.?&quot; ~ &quot;casual&quot;,
      &quot;Inv.&quot; ~ &quot;invasive&quot;,
      &quot;Nat.&quot; ~ &quot;established&quot;,
      &quot;Nat.?&quot; ~ &quot;established&quot;,
      .default = NA_character_
    )
  )</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>input_data |&gt;
  select(d_n, degree_of_establishment) |&gt;
  group_by(d_n, degree_of_establishment) |&gt;
  summarize(records = n()) |&gt;
  arrange(d_n)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["d_n"],"name":[1],"type":["chr"],"align":["left"]},{"label":["degree_of_establishment"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"Cas.","2":"casual","3":"6379"},{"1":"Cas.?","2":"casual","3":"173"},{"1":"Ext.","2":"NA","3":"92"},{"1":"Ext./Cas.","2":"casual","3":"50"},{"1":"Ext.?","2":"NA","3":"10"},{"1":"Inv.","2":"invasive","3":"244"},{"1":"Nat.","2":"established","3":"2200"},{"1":"Nat.?","2":"established","3":"342"},{"1":"NA","2":"NA","3":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="darwin-core-mapping" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Darwin Core
mapping</h1>
<div id="taxon-core" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Taxon core</h2>
<p>Map the data to <a
href="http://rs.gbif.org/core/dwc_taxon_2015-04-24.xml">Darwin Core
Taxon</a>:</p>
<pre class="r"><code>taxon &lt;-
  input_data |&gt;
  distinct(taxon_id, .keep_all = TRUE) |&gt; # Only keep one row per taxon
  mutate(
    .keep = &quot;none&quot;,
    language = &quot;en&quot;,
    license = &quot;http://creativecommons.org/publicdomain/zero/1.0/&quot;,
    rightsHolder = &quot;Meise Botanic Garden&quot;,
    datasetID = &quot;https://doi.org/10.15468/wtda1m&quot;,
    datasetName = &quot;Manual of the Alien Plants of Belgium&quot;,
    taxonID = taxon_id,
    scientificNameID = scientific_name_id,
    scientificName = taxon,
    kingdom = &quot;Plantae&quot;,
    family = family,
    taxonRank = taxon_rank,
    nomenclaturalCode = &quot;ICN&quot;
  ) |&gt;
  relocate(family, .after = kingdom) |&gt;
  arrange(taxonID)</code></pre>
</div>
<div id="distribution-extension" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Distribution
extension</h2>
<p>Map the data to <a
href="http://rs.gbif.org/extension/gbif/1.0/distribution_2022-02-02.xml">Species
Distribution</a>:</p>
<pre class="r"><code>distribution &lt;-
  input_data |&gt;
  filter(!is.na(presence)) |&gt; # Only keep taxa with a distribution
  mutate(
    .keep = &quot;none&quot;,
    taxonID = taxon_id,
    locationID = case_match(
      location,
      &quot;belgium&quot; ~ &quot;ISO_3166-2:BE&quot;,
      &quot;flanders&quot; ~ &quot;ISO_3166-2:BE-VLG&quot;,
      &quot;wallonia&quot; ~ &quot;ISO_3166-2:BE-WAL&quot;,
      &quot;brussels&quot; ~ &quot;ISO_3166-2:BE-BRU&quot;
    ),
    locality = case_match(
      location,
      &quot;belgium&quot; ~ &quot;Belgium&quot;,
      &quot;flanders&quot; ~ &quot;Flemish Region&quot;,
      &quot;wallonia&quot; ~ &quot;Walloon Region&quot;,
      &quot;brussels&quot; ~ &quot;Brussels-Capital Region&quot;
    ),
    countryCode = &quot;BE&quot;,
    occurrenceStatus = occurrence_status,
    establishmentMeans = &quot;introduced&quot;,
    degreeOfEstablishment = degree_of_establishment,
    pathway = mapped_pathway,
    eventDate = event_date
  ) |&gt;
  relocate(pathway, .after = degreeOfEstablishment) |&gt;
  arrange(taxonID)</code></pre>
</div>
<div id="species-profile-extension" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Species profile
extension</h2>
<p>In this extension will express broad habitat characteristics
(e.g. <code>isTerrestrial</code>) of the species. Habitat information
can be found in <code>habitat</code>, which describes whether a species
is found in freshwater, terrestrial or both (terrestrial/freshwater)
habitats.</p>
<p>Map the data to <a
href="http://rs.gbif.org/extension/gbif/1.0/speciesprofile.xml">Species
Profile</a>:</p>
<pre class="r"><code>species_profile &lt;-
  input_data |&gt;
  distinct(taxon_id, .keep_all = TRUE) |&gt; # Only keep one row per taxon
  mutate(habitat = str_to_lower(habitat)) |&gt;
  mutate(
    .keep = &quot;none&quot;,
    taxonID = taxon_id,
    isMarine = &quot;FALSE&quot;,
    isFreshwater = case_when(
      habitat == &quot;fresh water&quot; | habitat == &quot;terrestrial/fresh water&quot; ~ &quot;TRUE&quot;,
      TRUE ~ &quot;FALSE&quot;
    ),
    isTerrestrial = case_when(
      habitat == &quot;terrestrial&quot; | habitat == &quot;terrestrial/fresh water&quot; ~ &quot;TRUE&quot;,
      TRUE ~ &quot;FALSE&quot;
    )
  ) |&gt;
  arrange(taxonID)</code></pre>
</div>
<div id="description-extension" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Description
extension</h2>
<p>In the description extension we include the native range information.
This information is included in <code>origin</code>
(e.g. <code>E AS-Te NAM</code>). We’ll separate, clean, map and combine
these values.</p>
<p>Split <code>origin</code> on space in 4 columns. In case there are
more than 4 values, these will be merged in native_range_4. The dataset
currently contains no more than 4 values per record.</p>
<pre class="r"><code>native_range &lt;-
  input_data |&gt;
  distinct(taxon_id, .keep_all = TRUE) |&gt; # Only keep one row per taxon
  separate(
    origin,
    into = c(&quot;native_range_1&quot;, &quot;native_range_2&quot;, &quot;native_range_3&quot;, &quot;native_range_4&quot;),
    sep = &quot; &quot;,
    remove = FALSE,
    convert = FALSE,
    extra = &quot;merge&quot;,
    fill = &quot;right&quot;
  )</code></pre>
<p>Transform from wide to long (one line per native range):</p>
<pre class="r"><code>native_range &lt;-
  native_range |&gt;
  pivot_longer(
    cols = c(native_range_1, native_range_2, native_range_3, native_range_4),
    names_to = &quot;native_range_key&quot;,
    values_to = &quot;native_range&quot;,
    values_drop_na = TRUE # Also removes records for which there is no native_range_1
  )</code></pre>
<p>Map values:</p>
<pre class="r"><code>native_range &lt;-
  native_range |&gt;
  arrange(id) |&gt; # To see descriptions in order
  mutate(
    native_range = str_replace_all(native_range, &quot;\\?&quot;, &quot;&quot;), # Strip ?
    native_range = str_trim(native_range) # Clean whitespace
  ) |&gt;
  mutate(
    mapped_native_range = case_match(
      native_range,
      &quot;AF&quot; ~ &quot;Africa (WGSRPD:2)&quot;,
      &quot;AM&quot; ~ &quot;pan-American&quot;,
      &quot;AS&quot; ~ &quot;Asia&quot;,
      &quot;AS-Te&quot; ~ &quot;temperate Asia (WGSRPD:3)&quot;,
      &quot;AS-Tr&quot; ~ &quot;tropical Asia (WGSRPD:4)&quot;,
      &quot;AUS&quot; ~ &quot;Australasia (WGSRPD:5)&quot;,
      &quot;Cult.&quot; ~ &quot;cultivated origin&quot;,
      &quot;E&quot; ~ &quot;Europe (WGSRPD:1)&quot;,
      &quot;Hybr.&quot; ~ &quot;hybrid origin&quot;,
      &quot;NAM&quot; ~ &quot;Northern America (WGSRPD:7)&quot;,
      &quot;SAM&quot; ~ &quot;Southern America (WGSRPD:8)&quot;,
      &quot;Trop.&quot; ~ &quot;Pantropical&quot;,
      .default = NA_character_
    )
  ) |&gt;
  filter(!is.na(mapped_native_range))</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>native_range |&gt;
  select(native_range, mapped_native_range) |&gt;
  group_by(native_range, mapped_native_range) |&gt;
  summarize(records = n()) |&gt;
  arrange(native_range)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["native_range"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mapped_native_range"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"AF","2":"Africa (WGSRPD:2)","3":"662"},{"1":"AM","2":"pan-American","3":"95"},{"1":"AS","2":"Asia","3":"74"},{"1":"AS-Te","2":"temperate Asia (WGSRPD:3)","3":"1101"},{"1":"AS-Tr","2":"tropical Asia (WGSRPD:4)","3":"13"},{"1":"AUS","2":"Australasia (WGSRPD:5)","3":"120"},{"1":"Cult.","2":"cultivated origin","3":"94"},{"1":"E","2":"Europe (WGSRPD:1)","3":"1155"},{"1":"Hybr.","2":"hybrid origin","3":"71"},{"1":"NAM","2":"Northern America (WGSRPD:7)","3":"385"},{"1":"SAM","2":"Southern America (WGSRPD:8)","3":"161"},{"1":"Trop.","2":"Pantropical","3":"37"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Map the data to <a
href="http://rs.gbif.org/extension/gbif/1.0/description.xml">Taxon
Description</a>:</p>
<pre class="r"><code>description &lt;-
  native_range |&gt;
  mutate(
    .keep = &quot;none&quot;,
    taxonID = taxon_id,
    description = mapped_native_range,
    type = &quot;native range&quot;,
    language = &quot;en&quot;
  ) |&gt;
  relocate(type, .after = description) |&gt;
  arrange(taxonID)</code></pre>
</div>
</div>
<div id="save-to-csv" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Save to CSV</h1>
<pre class="r"><code>write_csv(taxon, here(&quot;data&quot;, &quot;processed&quot;, &quot;taxon.csv&quot;), na = &quot;&quot;)
write_csv(distribution, here(&quot;data&quot;, &quot;processed&quot;, &quot;distribution.csv&quot;), na = &quot;&quot;)
write_csv(species_profile, here(&quot;data&quot;, &quot;processed&quot;, &quot;speciesprofile.csv&quot;), na = &quot;&quot;)
write_csv(description, here(&quot;data&quot;, &quot;processed&quot;, &quot;description.csv&quot;), na = &quot;&quot;)</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
