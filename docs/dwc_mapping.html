<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lien Reyserhove" />
<meta name="author" content="Peter Desmet" />
<meta name="author" content="Quentin Groom" />

<meta name="date" content="2025-12-14" />

<title>Darwin Core mapping</title>

<script src="site_libs/header-attrs-2.30/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="static/css/trias.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">alien-plants-belgium</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="dwc_mapping.html">Darwin Core mapping</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/trias-project/alien-plants-belgium">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Darwin Core mapping</h1>
<h3 class="subtitle">For: Manual of the Alien Plants of Belgium</h3>
<h4 class="author">Lien Reyserhove</h4>
<h4 class="author">Peter Desmet</h4>
<h4 class="author">Quentin Groom</h4>
<h4 class="date">2025-12-14</h4>

</div>


<p>This document describes how we map the checklist data to Darwin Core.
The source file for this document can be found <a
href="https://github.com/trias-project/alien-plants-belgium/blob/master/src/dwc_mapping.Rmd">here</a>.</p>
<p>Load libraries:</p>
<pre class="r"><code>library(tidyverse)      # To do data science
library(magrittr)       # To use %&lt;&gt;% pipes
library(here)           # To find files
library(janitor)        # To clean input data
library(readxl)         # To read Excel files
library(digest)         # To generate hashes</code></pre>
<div id="read-source-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Read source data</h1>
<p>Create a data frame <code>input_data</code> from the source data:</p>
<pre class="r"><code>input_data &lt;- read_excel(path = here(&quot;data&quot;, &quot;raw&quot;, &quot;checklist.xlsx&quot;)) </code></pre>
<p>Preview data:</p>
<pre class="r"><code>input_data %&gt;% head(n = 5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Taxon"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Hybrid formula"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Synonym"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Family"],"name":[5],"type":["chr"],"align":["left"]},{"label":["M/I"],"name":[6],"type":["chr"],"align":["left"]},{"label":["FR"],"name":[7],"type":["chr"],"align":["left"]},{"label":["MRR"],"name":[8],"type":["chr"],"align":["left"]},{"label":["Origin"],"name":[9],"type":["chr"],"align":["left"]},{"label":["Presence_Fl"],"name":[10],"type":["chr"],"align":["left"]},{"label":["Presence_Br"],"name":[11],"type":["chr"],"align":["left"]},{"label":["Presence_Wa"],"name":[12],"type":["chr"],"align":["left"]},{"label":["D/N"],"name":[13],"type":["chr"],"align":["left"]},{"label":["V/I"],"name":[14],"type":["chr"],"align":["left"]},{"label":["taxonRank"],"name":[15],"type":["chr"],"align":["left"]},{"label":["scientificNameID"],"name":[16],"type":["chr"],"align":["left"]},{"label":["Habitat"],"name":[17],"type":["chr"],"align":["left"]},{"label":["Name (excl. author citation)"],"name":[18],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Acanthus hungaricus (Borbás) Baen.","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"2016","8":"2018","9":"E","10":"X","11":"X","12":"NA","13":"Cas.","14":"Hort.","15":"species","16":"NA","17":"Terrestrial","18":"Acanthus hungaricus"},{"1":"2","2":"Acanthus mollis L.","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"1998","8":"2016","9":"E AF","10":"X","11":"NA","12":"X","13":"Cas.","14":"Hort.","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:44892-1","17":"Terrestrial","18":"Acanthus mollis"},{"1":"3","2":"Acanthus spinosus L.","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"2016","8":"2018","9":"E AF AS-Te","10":"X","11":"NA","12":"NA","13":"Cas.","14":"Hort.","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:44920-1","17":"Terrestrial","18":"Acanthus spinosus"},{"1":"4","2":"Thunbergia alata Bojer ex Sims","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"2013","8":"2018","9":"AF","10":"X","11":"NA","12":"NA","13":"Cas.","14":"Hort.","15":"species","16":"NA","17":"Terrestrial","18":"Thunbergia alata"},{"1":"5","2":"Acorus calamus L.","3":"NA","4":"NA","5":"Acoraceae","6":"D","7":"1680","8":"N","9":"AS-Te","10":"X","11":"X","12":"X","13":"Nat.","14":"Hort.","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:84009-1","17":"Terrestrial/fresh water","18":"Acorus calamus"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="preprocessing" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Preprocessing</h1>
<div id="tidy-data" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Tidy data</h2>
<pre class="r"><code>input_data %&lt;&gt;%
  remove_empty(&quot;rows&quot;) %&gt;%       # Remove empty rows
  clean_names()                  # Have sensible (lowercase) column names</code></pre>
</div>
<div id="taxon-ids" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Taxon IDs</h2>
<p>To uniquely identify a taxon in the taxon core and reference taxa in
the extensions, we need a <code>taxonID</code>. Since we need it in all
generated files, we generate it here in the raw data frame. It is a
combination of <code>dataset-shortname:taxon:</code> and a hash based on
the scientific name. As long as the scientific name doesn’t change, the
ID will be stable:</p>
<pre class="r"><code># Vectorize the digest function (The digest() function isn&#39;t vectorized. So if you pass in a vector, you get one value for the whole vector rather than a digest for each element of the vector):
vdigest &lt;- Vectorize(digest)

# Generate taxonID:
input_data %&lt;&gt;% mutate(taxon_id = paste(&quot;alien-plants-belgium&quot;, &quot;taxon&quot;, vdigest (taxon, algo=&quot;md5&quot;), sep=&quot;:&quot;))</code></pre>
<p>Preview data:</p>
<pre class="r"><code>input_data %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["taxon"],"name":[2],"type":["chr"],"align":["left"]},{"label":["hybrid_formula"],"name":[3],"type":["chr"],"align":["left"]},{"label":["synonym"],"name":[4],"type":["chr"],"align":["left"]},{"label":["family"],"name":[5],"type":["chr"],"align":["left"]},{"label":["m_i"],"name":[6],"type":["chr"],"align":["left"]},{"label":["fr"],"name":[7],"type":["chr"],"align":["left"]},{"label":["mrr"],"name":[8],"type":["chr"],"align":["left"]},{"label":["origin"],"name":[9],"type":["chr"],"align":["left"]},{"label":["presence_fl"],"name":[10],"type":["chr"],"align":["left"]},{"label":["presence_br"],"name":[11],"type":["chr"],"align":["left"]},{"label":["presence_wa"],"name":[12],"type":["chr"],"align":["left"]},{"label":["d_n"],"name":[13],"type":["chr"],"align":["left"]},{"label":["v_i"],"name":[14],"type":["chr"],"align":["left"]},{"label":["taxon_rank"],"name":[15],"type":["chr"],"align":["left"]},{"label":["scientific_name_id"],"name":[16],"type":["chr"],"align":["left"]},{"label":["habitat"],"name":[17],"type":["chr"],"align":["left"]},{"label":["name_excl_author_citation"],"name":[18],"type":["chr"],"align":["left"]},{"label":["taxon_id"],"name":[19],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Acanthus hungaricus (Borbás) Baen.","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"2016","8":"2018","9":"E","10":"X","11":"X","12":"NA","13":"Cas.","14":"Hort.","15":"species","16":"NA","17":"Terrestrial","18":"Acanthus hungaricus","19":"alien-plants-belgium:taxon:20f16d5b689a7fbdb8d8fe5b15503d56"},{"1":"2","2":"Acanthus mollis L.","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"1998","8":"2016","9":"E AF","10":"X","11":"NA","12":"X","13":"Cas.","14":"Hort.","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:44892-1","17":"Terrestrial","18":"Acanthus mollis","19":"alien-plants-belgium:taxon:509ddbbaa5ecbb8d91899905cfc9491c"},{"1":"3","2":"Acanthus spinosus L.","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"2016","8":"2018","9":"E AF AS-Te","10":"X","11":"NA","12":"NA","13":"Cas.","14":"Hort.","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:44920-1","17":"Terrestrial","18":"Acanthus spinosus","19":"alien-plants-belgium:taxon:a65145fd1f24f081a1931f9874af48d9"},{"1":"4","2":"Thunbergia alata Bojer ex Sims","3":"NA","4":"NA","5":"Acanthaceae","6":"D","7":"2013","8":"2018","9":"AF","10":"X","11":"NA","12":"NA","13":"Cas.","14":"Hort.","15":"species","16":"NA","17":"Terrestrial","18":"Thunbergia alata","19":"alien-plants-belgium:taxon:f296e599fd529aa90eaa74a4f80ab725"},{"1":"5","2":"Acorus calamus L.","3":"NA","4":"NA","5":"Acoraceae","6":"D","7":"1680","8":"N","9":"AS-Te","10":"X","11":"X","12":"X","13":"Nat.","14":"Hort.","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:84009-1","17":"Terrestrial/fresh water","18":"Acorus calamus","19":"alien-plants-belgium:taxon:574eaf931730ba162e0226a425247660"},{"1":"6","2":"Actinidia deliciosa (Chevalier) C.S. Liang & A.R. Ferguson","3":"NA","4":"NA","5":"Actinidiaceae","6":"D","7":"2000","8":"Ann.","9":"AS-Te","10":"X","11":"NA","12":"X","13":"Cas.","14":"Food refuse","15":"species","16":"http://ipni.org/urn:lsid:ipni.org:names:913605-1","17":"Terrestrial","18":"Actinidia deliciosa","19":"alien-plants-belgium:taxon:5c33253debbe5777c0499b5c4d76b6e4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="darwin-core-mapping" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Darwin Core
mapping</h1>
<div id="taxon-core" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Taxon core</h2>
<p>Create a dataframe with unique taxa only (ignoring multiple
distribution rows):</p>
<pre class="r"><code>taxon &lt;- input_data %&gt;% distinct(taxon_id, .keep_all = TRUE)</code></pre>
<p>Map the data to <a
href="http://rs.gbif.org/core/dwc_taxon_2015-04-24.xml">Darwin Core
Taxon</a>:</p>
<div id="language" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> language</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_language = &quot;en&quot;)</code></pre>
</div>
<div id="license" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> license</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_license = &quot;http://creativecommons.org/publicdomain/zero/1.0/&quot;)</code></pre>
</div>
<div id="rightsholder" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> rightsHolder</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_rightsHolder = &quot;Botanic Garden Meise&quot;)</code></pre>
</div>
<div id="datasetid" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> datasetID</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_datasetID = &quot;https://doi.org/10.15468/wtda1m&quot;)</code></pre>
</div>
<div id="datasetname" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> datasetName</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_datasetName = &quot;Manual of the Alien Plants of Belgium&quot;)</code></pre>
</div>
<div id="taxonid" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> taxonID</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_taxonID = taxon_id)</code></pre>
</div>
<div id="scientificnameid" class="section level3" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span>
scientificNameID</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_scientificNameID = scientific_name_id)</code></pre>
</div>
<div id="scientificname" class="section level3" number="3.1.8">
<h3><span class="header-section-number">3.1.8</span> scientificName</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_scientificName = taxon)</code></pre>
</div>
<div id="kingdom" class="section level3" number="3.1.9">
<h3><span class="header-section-number">3.1.9</span> kingdom</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_kingdom = &quot;Plantae&quot;)</code></pre>
</div>
<div id="family" class="section level3" number="3.1.10">
<h3><span class="header-section-number">3.1.10</span> family</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_family = family)</code></pre>
</div>
<div id="taxonrank" class="section level3" number="3.1.11">
<h3><span class="header-section-number">3.1.11</span> taxonRank</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_taxonRank = taxon_rank)</code></pre>
</div>
<div id="nomenclaturalcode" class="section level3" number="3.1.12">
<h3><span class="header-section-number">3.1.12</span>
nomenclaturalCode</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(dwc_nomenclaturalCode = &quot;ICN&quot;)</code></pre>
</div>
</div>
<div id="distribution-extension" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Distribution
extension</h2>
<pre class="r"><code>distribution &lt;- input_data</code></pre>
<p>Before we start mapping the distribution extensions, we focus on two
terms: <code>occurrenceStatus</code> and <code>eventDate</code>:</p>
<p>This is because:</p>
<ol style="list-style-type: decimal">
<li><p>Information on the occurrences is given for the
<strong>regions</strong>, while date information is given for
<strong>Belgium</strong> as a whole. Some transformations and
clarifications are needed.</p></li>
<li><p>Some species have two values for <code>occurrenceStatus</code>
and <code>eventDate</code>, i.e. species with the degree of
naturalisation (<code>d_n</code>) of extinct (<code>Ext.</code>) or
extinct/casual (<code>Ext./Cas.</code>).</p></li>
</ol>
<blockquote>
<p>Extinct: introduced taxa that once were naturalized (usually rather
locally) but that have not been confirmed in recent times in their known
localities. Only taxa that are certainly extinct are indicated as
such.<br />
Extinct/casual: Some of these extinct taxa are no longer considered as
naturalized but still occur as casuals; such taxa are indicated as
“Ext./Cas.” (for instance <em>Tragopogon porrifolius</em>).</p>
</blockquote>
<p>For these species, we include the occurrenceStatus
<strong>within</strong> the specified time frame (<code>eventDate</code>
= first - most recent observation) and <strong>after</strong> the last
observation (<code>eventDate</code> = most recent observation - current
date).</p>
<p>The easiest way to do use a stepwize approach: 1. Clean presence
information and date information in <code>distribution</code> 2. Create
a separate dataframe <code>occurrenceStatus_ALO</code> (ALO = after last
observation) for extinct and extinct/casual species 3. Map
<code>occurrenceStatus</code> and <code>eventDate</code> from cleaned
presence and date information in <code>distribution</code> (for
<code>eventDate</code> = first - most recent observation) 4. Map
<code>occurrenceStatus</code> and <code>eventDate</code> from cleaned
presence and date information in <code>occurrenceStatus_ALO</code> (for
<code>eventDate</code> = most recent observation - current date) 5. Bind
both dataframes by row. 6. Map the other Darwin Core terms in the
distribution extension</p>
<p>The checklist contains minimal presence information
(<code>X</code>,<code>?</code> or <code>NA</code>) for the three regions
in Belgium: Flanders, Wallonia and the Brussels-Capital Region,
contained in <code>presence_fl</code>, <code>presence_wa</code> and
<code>presence_br</code> respectively. Information regarding the
first/last recorded observation applies to the distribution in Belgium
as a whole. Both national and regional information is required in the
checklist. In the <code>distribution.csv</code>, we will first provide
<code>occurrenceStatus</code> and `eventDate`` on a <strong>national
level</strong>, followed by specific information for the
<strong>regions</strong>.</p>
<p>For this, we use the following principles:</p>
<ol style="list-style-type: decimal">
<li><p>When a species is present in <em>only one region</em>, we can
assume <code>eventDate</code> relates to that specific region. In this
case, we can keep lines for Belgium and for the specific region
populated with these variables (see #45).</p></li>
<li><p>When a species is present in <em>more than one</em> region, it is
impossible to extrapolate the date information for the regions. In this
case, we decided to provide <code>occurrenceStatus</code> for the
regional information, and specify dates only for Belgium.</p></li>
</ol>
<p>Thus, we need to specify when a species is present in only one of the
regions.</p>
<p>We generate 4 new columns: <code>Flanders</code>,
<code>Brussels</code>,<code>Wallonia</code> and <code>Belgium</code>.
The content of these columns refers to the specific presence status of a
species on a regional or national level. <code>S</code> if present in a
single region or in Belgium, <code>?</code> if presence uncertain,
<code>NA</code> if absent and <code>M</code> if present in multiple
regions.</p>
<p>This should look like this:</p>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["presence_fl"],"name":[1],"type":["chr"],"align":["left"]},{"label":["presence_br"],"name":[2],"type":["chr"],"align":["left"]},{"label":["presence_wa"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Flanders"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Brussels"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Wallonia"],"name":[6],"type":["chr"],"align":["left"]},{"label":["Belgium"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"X","2":"NA","3":"NA","4":"S","5":"NA","6":"NA","7":"S","_rn_":"1"},{"1":"NA","2":"X","3":"NA","4":"NA","5":"S","6":"NA","7":"S","_rn_":"2"},{"1":"NA","2":"NA","3":"x","4":"NA","5":"NA","6":"S","7":"S","_rn_":"3"},{"1":"X","2":"X","3":"NA","4":"M","5":"M","6":"NA","7":"S","_rn_":"4"},{"1":"X","2":"NA","3":"X","4":"M","5":"NA","6":"M","7":"S","_rn_":"5"},{"1":"NA","2":"X","3":"X","4":"NA","5":"M","6":"M","7":"S","_rn_":"6"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","_rn_":"7"},{"1":"X","2":"?","3":"NA","4":"S","5":"?","6":"NA","7":"S","_rn_":"8"},{"1":"X","2":"NA","3":"?","4":"S","5":"NA","6":"?","7":"S","_rn_":"9"},{"1":"X","2":"X","3":"?","4":"M","5":"M","6":"?","7":"S","_rn_":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We translate this to the distribution extension:</p>
<pre class="r"><code>distribution %&lt;&gt;% 
  mutate(Flanders = case_when(
    presence_fl == &quot;X&quot; &amp; (is.na(presence_br) | presence_br == &quot;?&quot;) &amp; (is.na(presence_wa) | presence_wa == &quot;?&quot;) ~ &quot;S&quot;,
    presence_fl == &quot;?&quot; ~ &quot;?&quot;,
    is.na(presence_fl) ~ &quot;NA&quot;,
    TRUE ~ &quot;M&quot;)) %&gt;%
  mutate(Brussels = case_when(
    (is.na(presence_fl) | presence_fl == &quot;?&quot;) &amp; presence_br == &quot;X&quot; &amp; (is.na(presence_wa) | presence_wa == &quot;?&quot;) ~ &quot;S&quot;,
    presence_br == &quot;?&quot; ~ &quot;?&quot;,
    is.na(presence_br) ~ &quot;NA&quot;,
    TRUE ~ &quot;M&quot;)) %&gt;%
  mutate(Wallonia = case_when(
    (is.na(presence_fl) | presence_fl == &quot;?&quot;) &amp; (is.na(presence_br) | presence_br == &quot;?&quot;) &amp; presence_wa == &quot;X&quot; ~ &quot;S&quot;,
    presence_wa == &quot;?&quot; ~ &quot;?&quot;,
    is.na(presence_wa) ~ &quot;NA&quot;,
    TRUE ~ &quot;M&quot;)) %&gt;%
  mutate(Belgium = case_when(
    presence_fl == &quot;X&quot; | presence_br == &quot;X&quot; | presence_wa == &quot;X&quot; ~ &quot;S&quot;, # One is &quot;X&quot;
    presence_fl == &quot;?&quot; | presence_br == &quot;?&quot; | presence_wa == &quot;?&quot; ~ &quot;?&quot; # One is &quot;?&quot;
  ))</code></pre>
<p>Summary of the previous action:</p>
<pre class="r"><code>distribution %&gt;% select(presence_fl, presence_br, presence_wa, Flanders, Wallonia, Brussels, Belgium) %&gt;%
  group_by_all() %&gt;%
  summarize(records = n()) %&gt;%
  arrange(Flanders, Wallonia, Brussels)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["presence_fl"],"name":[1],"type":["chr"],"align":["left"]},{"label":["presence_br"],"name":[2],"type":["chr"],"align":["left"]},{"label":["presence_wa"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Flanders"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Wallonia"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Brussels"],"name":[6],"type":["chr"],"align":["left"]},{"label":["Belgium"],"name":[7],"type":["chr"],"align":["left"]},{"label":["records"],"name":[8],"type":["int"],"align":["right"]}],"data":[{"1":"?","2":"?","3":"?","4":"?","5":"?","6":"?","7":"?","8":"21"},{"1":"?","2":"X","3":"?","4":"?","5":"?","6":"S","7":"S","8":"1"},{"1":"X","2":"?","3":"X","4":"M","5":"M","6":"?","7":"S","8":"5"},{"1":"X","2":"X","3":"X","4":"M","5":"M","6":"M","7":"S","8":"505"},{"1":"X","2":"NA","3":"X","4":"M","5":"M","6":"__NA__","7":"S","8":"648"},{"1":"X","2":"X","3":"NA","4":"M","5":"__NA__","6":"M","7":"S","8":"78"},{"1":"NA","2":"X","3":"X","4":"__NA__","5":"M","6":"M","7":"S","8":"23"},{"1":"NA","2":"NA","3":"NA","4":"__NA__","5":"__NA__","6":"__NA__","7":"NA","8":"2"},{"1":"NA","2":"X","3":"NA","4":"__NA__","5":"__NA__","6":"S","7":"S","8":"34"},{"1":"NA","2":"NA","3":"X","4":"__NA__","5":"S","6":"__NA__","7":"S","8":"455"},{"1":"X","2":"?","3":"?","4":"S","5":"?","6":"?","7":"S","8":"3"},{"1":"X","2":"NA","3":"?","4":"S","5":"?","6":"__NA__","7":"S","8":"1"},{"1":"X","2":"NA","3":"NA","4":"S","5":"__NA__","6":"__NA__","7":"S","8":"841"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>One line should represent the presence information of a species in
one region or Belgium. We need to transform <code>distribution</code>
from a wide to a long table (i.e. create a <code>key</code> and
<code>value</code> column):</p>
<pre class="r"><code>distribution %&lt;&gt;% gather(
  key, value,
  Flanders, Wallonia, Brussels, Belgium,
  convert = FALSE
) </code></pre>
<p>Rename <code>key</code> and <code>value</code>:</p>
<pre class="r"><code>distribution %&lt;&gt;% rename(&quot;location&quot; = &quot;key&quot;, &quot;presence&quot; = &quot;value&quot;)</code></pre>
<p>Remove species for which we lack presence information
(i.e. <code>presence</code> = `NA``):</p>
<pre class="r"><code>distribution %&lt;&gt;% filter(!presence == &quot;NA&quot;)</code></pre>
<p>Now, we will clean date information</p>
<p>Create <code>start_year</code> from <code>fr</code>:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(start_year = fr)</code></pre>
<p>Clean values:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(start_year = 
  str_replace_all(start_year, &quot;(\\?|ca. |&lt;|&gt;)&quot;, &quot;&quot;) # Strip ?, ca., &lt; and &gt;
)</code></pre>
<p>Create <code>end_year</code> from <code>mrr</code> (most recent
record):</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(end_year = mrr)</code></pre>
<p>Clean values:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(end_year = 
  str_replace_all(end_year, &quot;(\\?|ca. |&lt;|&gt;)&quot;, &quot;&quot;) # Strip ?, ca., &lt; and &gt;
)</code></pre>
<p>If <code>end_year</code> is <code>Ann.</code> or <code>N</code> use
current year:</p>
<pre class="r"><code>current_year = format(Sys.Date(), &quot;%Y&quot;)
distribution %&lt;&gt;% mutate(end_year = recode(end_year,
  &quot;Ann.&quot; = current_year,
  &quot;N&quot; = current_year)
)</code></pre>
<p>Show reformatted values for both <code>fr</code> and
<code>mrr</code>:</p>
<pre class="r"><code>distribution %&gt;%
  select(fr, start_year) %&gt;%
  rename(year = fr, formatted_year = start_year) %&gt;%
  union( # Union with mrr. Will also remove duplicates
    distribution %&gt;%
      select(mrr, end_year) %&gt;%
      rename(year = mrr, formatted_year = end_year)
  ) %&gt;%
  filter(nchar(year) != 4) %&gt;% # Don&#39;t show raw values that were already YYYY
  arrange(year)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["chr"],"align":["left"]},{"label":["formatted_year"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"1813?","2":"1813"},{"1":"1817?","2":"1817"},{"1":"1860?","2":"1860"},{"1":"1866?","2":"1866"},{"1":"1886?","2":"1886"},{"1":"1893?","2":"1893"},{"1":"1911?","2":"1911"},{"1":"1912?","2":"1912"},{"1":"1931?","2":"1931"},{"1":"1947?","2":"1947"},{"1":"1955?","2":"1955"},{"1":"1959?","2":"1959"},{"1":"1960?","2":"1960"},{"1":"1963?","2":"1963"},{"1":"1965?","2":"1965"},{"1":"1972?","2":"1972"},{"1":"1975?","2":"1975"},{"1":"1976?","2":"1976"},{"1":"1979?","2":"1979"},{"1":"1985?","2":"1985"},{"1":"1998?","2":"1998"},{"1":"2000?","2":"2000"},{"1":"2002?","2":"2002"},{"1":"2004?","2":"2004"},{"1":"2006?","2":"2006"},{"1":"2010?","2":"2010"},{"1":"<1800","2":"1800"},{"1":"<1812","2":"1812"},{"1":"<1824","2":"1824"},{"1":"<1827","2":"1827"},{"1":"<1830","2":"1830"},{"1":"<1834","2":"1834"},{"1":"<1835","2":"1835"},{"1":"<1836","2":"1836"},{"1":"<1837","2":"1837"},{"1":"<1842","2":"1842"},{"1":"<1850","2":"1850"},{"1":"<1858","2":"1858"},{"1":"<1861","2":"1861"},{"1":"<1865","2":"1865"},{"1":"<1868","2":"1868"},{"1":"<1885","2":"1885"},{"1":"<1890","2":"1890"},{"1":"<1893","2":"1893"},{"1":"<1895","2":"1895"},{"1":"<1899","2":"1899"},{"1":"<1900","2":"1900"},{"1":"<1900?","2":"1900"},{"1":"<1914","2":"1914"},{"1":"<1927","2":"1927"},{"1":"<1929","2":"1929"},{"1":"<1934","2":"1934"},{"1":"<1949","2":"1949"},{"1":"<1950","2":"1950"},{"1":"<1951","2":"1951"},{"1":"<1957","2":"1957"},{"1":"<1963","2":"1963"},{"1":"<1979","2":"1979"},{"1":"<1980","2":"1980"},{"1":"<1994","2":"1994"},{"1":"<1997","2":"1997"},{"1":"<1999","2":"1999"},{"1":"<2003","2":"2003"},{"1":"<2010","2":"2010"},{"1":"<2011","2":"2011"},{"1":"<2012","2":"2012"},{"1":">1940","2":"1940"},{"1":">1972","2":"1972"},{"1":"?","2":""},{"1":"N","2":"2025"},{"1":"N?","2":"2025"},{"1":"ca. 1975","2":"1975"},{"1":"ca. 1985?","2":"1985"},{"1":"ca. 1996","2":"1996"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Check if any <code>start_year</code> fall after <code>end_year</code>
(expected to be none):</p>
<pre class="r"><code>distribution %&gt;%
  select(start_year, end_year) %&gt;%
  mutate(start_year = as.numeric(start_year)) %&gt;%
  mutate(end_year = as.numeric(end_year)) %&gt;%
  group_by(start_year, end_year) %&gt;%
  summarize(records = n()) %&gt;%
  filter(start_year &gt; end_year) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["start_year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["end_year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Combine <code>start_year</code> and <code>end_year</code> in an
ranged <code>Date</code> (ISO 8601 format). If any those two dates is
empty or the same, we use a single year, as a statement when it was seen
once (either as a first record or a most recent record):</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(Date = case_when(
  start_year == &quot;&quot; &amp; end_year == &quot;&quot; ~ &quot;&quot;,
  start_year == &quot;&quot;                  ~ end_year,
  end_year == &quot;&quot;                    ~ start_year,
  start_year == end_year            ~ start_year,
  TRUE                              ~ paste(start_year, end_year, sep = &quot;/&quot;)
))</code></pre>
<p>In a next step, we will generate
<code>occurrenceStatus_ALO</code></p>
<pre class="r"><code>occurrenceStatus_ALO &lt;- distribution %&gt;% filter(d_n == &quot;Ext.&quot; | d_n == &quot;Ext./Cas.&quot;)</code></pre>
<p>Then, we map occurrenceStatus and eventDate for
<code>distribution</code>:</p>
<p>Map <code>occurrenceStaus</code> using <a
href="http://www.iucnredlist.org/technical-documents/red-list-training/iucnspatialresources">IUCN
definitions</a>:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(occurrenceStatus = recode(presence,
  &quot;S&quot; = &quot;present&quot;,
  &quot;M&quot; = &quot;present&quot;,
  &quot;?&quot; = &quot;presence uncertain&quot;,
  .default = &quot;&quot;
))</code></pre>
<p>Overview of <code>occurrenceStatus</code> for each location x
presence combination:</p>
<pre class="r"><code>distribution %&gt;% select (location, presence, occurrenceStatus) %&gt;%
  group_by_all() %&gt;%
  summarize(records = n()) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["presence"],"name":[2],"type":["chr"],"align":["left"]},{"label":["occurrenceStatus"],"name":[3],"type":["chr"],"align":["left"]},{"label":["records"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"Belgium","2":"?","3":"presence uncertain","4":"21"},{"1":"Belgium","2":"S","3":"present","4":"2594"},{"1":"Brussels","2":"?","3":"presence uncertain","4":"29"},{"1":"Brussels","2":"M","3":"present","4":"606"},{"1":"Brussels","2":"S","3":"present","4":"35"},{"1":"Flanders","2":"?","3":"presence uncertain","4":"22"},{"1":"Flanders","2":"M","3":"present","4":"1236"},{"1":"Flanders","2":"S","3":"present","4":"845"},{"1":"Wallonia","2":"?","3":"presence uncertain","4":"26"},{"1":"Wallonia","2":"M","3":"present","4":"1181"},{"1":"Wallonia","2":"S","3":"present","4":"455"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Populate <code>eventDate</code> only when <code>presence</code> =
<code>S</code>:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(eventDate = case_when(
  presence == &quot;S&quot; ~ Date,
  TRUE ~ &quot;&quot;
))</code></pre>
<p>Map <code>occurrenceStatus</code> and <code>eventDate</code> for
<code>occurrenceStatus_ALO</code>:</p>
<pre class="r"><code>occurrenceStatus_ALO %&lt;&gt;% mutate(occurrenceStatus = case_when(
  d_n == &quot;Ext.&quot; ~ &quot;absent&quot;,
  d_n == &quot;Ext./Cas.&quot; ~ &quot;present&quot;
))

occurrenceStatus_ALO %&lt;&gt;% mutate(eventDate = case_when(
  presence == &quot;S&quot; ~ paste(end_year, current_year, sep = &quot;/&quot;)
))</code></pre>
<p>Bind <code>occurrenceStatus_ALO</code> and <code>distribution</code>
by rows:</p>
<pre class="r"><code>distribution %&lt;&gt;% bind_rows(occurrenceStatus_ALO)</code></pre>
<p>Map the data to <a
href="http://rs.gbif.org/extension/gbif/1.0/distribution.xml">Species
Distribution</a>:</p>
<div id="taxonid-1" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> taxonID</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_taxonID = taxon_id)</code></pre>
</div>
<div id="locationid" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> locationID</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_locationID = case_when(
  location == &quot;Belgium&quot; ~ &quot;ISO_3166-2:BE&quot;,
  location == &quot;Flanders&quot; ~ &quot;ISO_3166-2:BE-VLG&quot;,
  location == &quot;Wallonia&quot; ~ &quot;ISO_3166-2:BE-WAL&quot;,
  location == &quot;Brussels&quot; ~ &quot;ISO_3166-2:BE-BRU&quot;
))</code></pre>
</div>
<div id="locality" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> locality</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_locality = case_when(
  location == &quot;Belgium&quot; ~ &quot;Belgium&quot;,
  location == &quot;Flanders&quot; ~ &quot;Flemish Region&quot;,
  location == &quot;Wallonia&quot; ~ &quot;Walloon Region&quot;,
  location == &quot;Brussels&quot; ~ &quot;Brussels-Capital Region&quot;
))</code></pre>
</div>
<div id="countrycode" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> countryCode</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_countryCode = &quot;BE&quot;)</code></pre>
</div>
<div id="occurrencestatus" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span>
occurrenceStatus</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_occurrenceStatus = occurrenceStatus) </code></pre>
</div>
<div id="establishmentmeans" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span>
establishmentMeans</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_establishmentMeans = &quot;introduced&quot;)</code></pre>
</div>
<div id="eventdate" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> eventDate</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(dwc_eventDate = eventDate) </code></pre>
</div>
</div>
<div id="species-profile-extension" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Species profile
extension</h2>
<p>In this extension will express broad habitat characteristics
(e.g. <code>isTerrestrial</code>) of the species.</p>
<pre class="r"><code>species_profile &lt;- input_data</code></pre>
<p>Habitat information can be found in <code>habitat</code>, which
describes whether a species is found in freshwater, terrestrial or both
(terrestrial/freshwater) habitats.</p>
<p>Show unique values:</p>
<pre class="r"><code>species_profile %&gt;%
  distinct(habitat) %&gt;%
  arrange(habitat)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["habitat"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"Fresh water"},{"1":"Terrestrial"},{"1":"Terrestrial/fresh water"},{"1":"terrestrial"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Clean content somewhat, i.e. change uppercase to lowercase</p>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(habitat = str_to_lower(habitat)) </code></pre>
<p>We map this information respectively to <code>isFreshwater</code>,
<code>isTerrestrial</code> or both terms in the species profile
extension.</p>
<p>Map the data to <a
href="http://rs.gbif.org/extension/gbif/1.0/speciesprofile.xml">Species
Profile</a>:</p>
<div id="taxonid-2" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> taxonID</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(dwc_taxonID = taxon_id)</code></pre>
</div>
<div id="ismarine" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> isMarine</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(dwc_isMarine = &quot;FALSE&quot;)</code></pre>
</div>
<div id="isfreshwater" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> isFreshwater</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(dwc_isFreshwater = case_when(
  habitat == &quot;fresh water&quot; | habitat == &quot;terrestrial/fresh water&quot; ~ &quot;TRUE&quot;,
  TRUE ~&quot;FALSE&quot;
))</code></pre>
</div>
<div id="isterrestrial" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> isTerrestrial</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(dwc_isTerrestrial = case_when(
  habitat == &quot;terrestrial&quot; | habitat == &quot;terrestrial/fresh water&quot; ~ &quot;TRUE&quot;,
  TRUE ~&quot;FALSE&quot;
))</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>species_profile %&gt;%
  select(habitat, dwc_isMarine, dwc_isFreshwater, dwc_isTerrestrial) %&gt;%
  group_by_all() %&gt;%
  summarize(records = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["habitat"],"name":[1],"type":["chr"],"align":["left"]},{"label":["dwc_isMarine"],"name":[2],"type":["chr"],"align":["left"]},{"label":["dwc_isFreshwater"],"name":[3],"type":["chr"],"align":["left"]},{"label":["dwc_isTerrestrial"],"name":[4],"type":["chr"],"align":["left"]},{"label":["records"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"fresh water","2":"FALSE","3":"TRUE","4":"FALSE","5":"29"},{"1":"terrestrial","2":"FALSE","3":"FALSE","4":"TRUE","5":"2582"},{"1":"terrestrial/fresh water","2":"FALSE","3":"TRUE","4":"TRUE","5":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="description-extension" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Description
extension</h2>
<p>In the description extension we want to include several important
characteristics (hereafter refered to as descriptors) about the
species:</p>
<ul>
<li>Native range</li>
<li>Pathway of introduction</li>
<li>Invasion stage</li>
</ul>
<p>A single taxon can have multiple descriptions of the same type
(e.g. multiple native ranges), expressed as multiple rows in the
description extension.</p>
<p>For each descriptor, we create a separate dataframe to process the
specific information. We always specify <em>which descriptor</em> we map
(<code>type</code> column) and its <em>specific content</em>
(<code>description</code> column). After the mapping of these Darwin
Core terms <code>type</code> and <code>value</code>, we merge the
dataframes to generate one single description extension. We then
continue the mapping process by adding the other Darwin Core terms
(which content is independent of the type of descriptor, such as
<code>language</code>).</p>
<div id="native-range" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> native range</h3>
<p><code>origin</code> contains native range information
(e.g. <code>E AS-Te NAM</code>). We’ll separate, clean, map and combine
these values.</p>
<p>Create separate dataframe:</p>
<pre class="r"><code>native_range &lt;- input_data</code></pre>
<p>Create <code>description</code> from <code>origin</code>:</p>
<pre class="r"><code>native_range %&lt;&gt;% mutate(description = origin)</code></pre>
<p>Separate <code>description</code> on space in 4 columns: In case
there are more than 4 values, these will be merged in native_range_4.
The dataset currently contains no more than 4 values per record.</p>
<pre class="r"><code>native_range %&lt;&gt;% separate(
  description,
  into = c(&quot;native_range_1&quot;, &quot;native_range_2&quot;, &quot;native_range_3&quot;, &quot;native_range_4&quot;),
  sep = &quot; &quot;,
  remove = TRUE,
  convert = FALSE,
  extra = &quot;merge&quot;,
  fill = &quot;right&quot;
)</code></pre>
<p>Gather native ranges in a key and value column:</p>
<pre class="r"><code>native_range %&lt;&gt;% gather(
  key, value,
  native_range_1, native_range_2, native_range_3, native_range_4,
  na.rm = TRUE, # Also removes records for which there is no native_range_1
  convert = FALSE
)</code></pre>
<p>Sort on ID to see pathways in context for each record:</p>
<pre class="r"><code>native_range %&lt;&gt;% arrange(id)</code></pre>
<p>Clean values:</p>
<pre class="r"><code>native_range %&lt;&gt;% mutate(
  value = str_replace_all(value, &quot;\\?&quot;, &quot;&quot;), # Strip ?
  value = str_trim(value) # Clean whitespace
)</code></pre>
<p>Map values:</p>
<pre class="r"><code>native_range %&lt;&gt;% mutate(mapped_value = recode(value,
  &quot;AF&quot; = &quot;Africa (WGSRPD:2)&quot;,
  &quot;AM&quot; = &quot;pan-American&quot;,
  &quot;AS&quot; = &quot;Asia&quot;,
  &quot;AS-Te&quot; = &quot;temperate Asia (WGSRPD:3)&quot;,
  &quot;AS-Tr&quot; = &quot;tropical Asia (WGSRPD:4)&quot;,
  &quot;AUS&quot; = &quot;Australasia (WGSRPD:5)&quot;,
  &quot;Cult.&quot; = &quot;cultivated origin&quot;,
  &quot;E&quot; = &quot;Europe (WGSRPD:1)&quot;,
  &quot;Hybr.&quot; = &quot;hybrid origin&quot;,
  &quot;NAM&quot; = &quot;Northern America (WGSRPD:7)&quot;,
  &quot;SAM&quot; = &quot;Southern America (WGSRPD:8)&quot;,
  &quot;Trop.&quot; = &quot;Pantropical&quot;,
  .default = &quot;&quot;,
  .missing = &quot;&quot; # As result of stripping, records with no native range already removed by gather()
))</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>native_range %&gt;%
  select(value, mapped_value) %&gt;%
  group_by(value, mapped_value) %&gt;%
  summarize(records = n()) %&gt;%
  arrange(value)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["value"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mapped_value"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"","2":"","3":"1"},{"1":"AF","2":"Africa (WGSRPD:2)","3":"662"},{"1":"AM","2":"pan-American","3":"95"},{"1":"AS","2":"Asia","3":"74"},{"1":"AS-Te","2":"temperate Asia (WGSRPD:3)","3":"1101"},{"1":"AS-Tr","2":"tropical Asia (WGSRPD:4)","3":"13"},{"1":"AUS","2":"Australasia (WGSRPD:5)","3":"120"},{"1":"Cult.","2":"cultivated origin","3":"94"},{"1":"E","2":"Europe (WGSRPD:1)","3":"1155"},{"1":"Hybr.","2":"hybrid origin","3":"71"},{"1":"NAM","2":"Northern America (WGSRPD:7)","3":"385"},{"1":"SAM","2":"Southern America (WGSRPD:8)","3":"161"},{"1":"Trop.","2":"Pantropical","3":"37"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Drop <code>key</code> and <code>value</code> column and rename
<code>mapped value</code>:</p>
<pre class="r"><code>native_range %&lt;&gt;% select(-key, -value)
native_range %&lt;&gt;% rename(description = mapped_value)</code></pre>
<p>Keep only non-empty descriptions:</p>
<pre class="r"><code>native_range %&lt;&gt;% filter(!is.na(description) &amp; description != &quot;&quot;)</code></pre>
<p>Create a <code>type</code> field to indicate the type of
description:</p>
<pre class="r"><code>native_range %&lt;&gt;% mutate(type = &quot;native range&quot;)</code></pre>
</div>
<div id="pathway-of-introduction" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> pathway of
introduction</h3>
<p>Pathway information is based on <code>v_i</code>, which contains a
list of introduction pathways (e.g. <code>Agric., wool</code>). We’ll
separate, clean, map and combine these values.</p>
<p>Create separate dataframe:</p>
<pre class="r"><code>pathway &lt;- input_data</code></pre>
<p>Create <code>pathway</code> from <code>v_i</code>:</p>
<pre class="r"><code>pathway %&lt;&gt;% mutate(pathway = v_i)</code></pre>
<p>Separate <code>pathway</code> on <code>,</code> in 4 columns: In case
there are more than 4 values, these will be merged in pathway_4. The
dataset currently contains no more than 3 values per record.</p>
<pre class="r"><code>pathway %&lt;&gt;% separate(
  pathway,
  into = c(&quot;pathway_1&quot;, &quot;pathway_2&quot;, &quot;pathway_3&quot;, &quot;pathway_4&quot;),
  sep = &quot;,&quot;,
  remove = TRUE,
  convert = FALSE,
  extra = &quot;merge&quot;,
  fill = &quot;right&quot;
)</code></pre>
<p>Gather pathways in a key and value column:</p>
<pre class="r"><code>pathway %&lt;&gt;% gather(
  key, value,
  pathway_1, pathway_2, pathway_3, pathway_4,
  na.rm = TRUE, # Also removes records for which there is no pathway_1
  convert = FALSE
)</code></pre>
<p>Sort on <code>taxon_id</code> to see pathways in context for each
record:</p>
<pre class="r"><code>pathway %&lt;&gt;% arrange(taxon_id)</code></pre>
<p>Show unique values:</p>
<pre class="r"><code>pathway %&gt;%
  distinct(value) %&gt;%
  arrange(value) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["value"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":""},{"1":"..."},{"1":"Ore"},{"1":"agric."},{"1":"birdseed"},{"1":"etc."},{"1":"grain"},{"1":"grain?"},{"1":"hort."},{"1":"hort.?"},{"1":"hort.…"},{"1":"nurseries"},{"1":"ore"},{"1":"ore?"},{"1":"salt"},{"1":"seeds"},{"1":"seeds?"},{"1":"timber?"},{"1":"tourists"},{"1":"urban weed"},{"1":"wool"},{"1":"…"},{"1":"..."},{"1":"?"},{"1":"Agric."},{"1":"Bird seed"},{"1":"Birdseed"},{"1":"Birdseed?"},{"1":"Bulbs?"},{"1":"Coconut mats"},{"1":"Fish"},{"1":"Food refuse"},{"1":"Food refuse?"},{"1":"Grain"},{"1":"Grain (rice)"},{"1":"Grain?"},{"1":"Grass seed"},{"1":"Grass seed?"},{"1":"Hay?"},{"1":"Hort"},{"1":"Hort."},{"1":"Hort.?"},{"1":"Hybridization"},{"1":"Military troops"},{"1":"Military troops?"},{"1":"Nurseries"},{"1":"Nurseries?"},{"1":"Ore"},{"1":"Ore?"},{"1":"Pines"},{"1":"Rice"},{"1":"Seeds"},{"1":"Seeds?"},{"1":"Timber"},{"1":"Timber?"},{"1":"Tourists"},{"1":"Traffic?"},{"1":"Urban weed"},{"1":"Waterfowl"},{"1":"Waterfowl?"},{"1":"Wool"},{"1":"Wool alien"},{"1":"Wool?"},{"1":"hort."},{"1":"…"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Clean values:</p>
<pre class="r"><code>pathway %&lt;&gt;% mutate(
  value = str_replace_all(value, &quot;\\?|…|\\.{3}&quot;, &quot;&quot;), # Strip ?, …, ...
  value = str_to_lower(value), # Convert to lowercase
  value = str_trim(value) # Clean whitespace
)</code></pre>
<p>Map values to the CBD standard::</p>
<pre class="r"><code>pathway %&lt;&gt;% mutate(cbd_stand = recode(value, 
  &quot;agric.&quot; = &quot;escape_agriculture&quot;,
  &quot;bird seed&quot; = &quot;contaminant_seed&quot;,
  &quot;birdseed&quot; = &quot;contaminant_seed&quot;,
  &quot;bulbs&quot; = &quot;&quot;,
  &quot;coconut mats&quot; = &quot;contaminant_seed&quot;,
  &quot;fish&quot; = &quot;&quot;,
  &quot;food refuse&quot; = &quot;escape_food_bait&quot;,
  &quot;grain&quot; = &quot;contaminant_seed&quot;,
  &quot;grain (rice)&quot; = &quot;contaminant_seed&quot;,
  &quot;grass seed&quot; = &quot;contaminant_seed&quot;,
  &quot;hay&quot; = &quot;&quot;,
  &quot;hort&quot; = &quot;escape_horticulture&quot;,
  &quot;hort.&quot; = &quot;escape_horticulture&quot;,
  &quot;hybridization&quot; = &quot;&quot;,
  &quot;military troops&quot; = &quot;&quot;,
  &quot;nurseries&quot; = &quot;contaminant_nursery&quot;,
  &quot;ore&quot; = &quot;contaminant_habitat_material&quot;,
  &quot;pines&quot; = &quot;contaminant_on_plants&quot;,
  &quot;rice&quot; = &quot;&quot;,
  &quot;salt&quot; = &quot;&quot;,
  &quot;seeds&quot; = &quot;contaminant_seed&quot;,
  &quot;timber&quot; = &quot;contaminant_timber&quot;,
  &quot;tourists&quot; = &quot;stowaway_people_luggage&quot;,
  &quot;traffic&quot; = &quot;&quot;,
  &quot;unknown&quot; = &quot;unknown&quot;,
  &quot;urban weed&quot; = &quot;stowaway&quot;,
  &quot;waterfowl&quot; = &quot;contaminant_on_animals&quot;,
  &quot;wool&quot; = &quot;contaminant_on_animals&quot;,
  &quot;wool alien&quot; = &quot;contaminant_on_animals&quot;,
  .default = &quot;&quot;,
  .missing = &quot;&quot; # As result of stripping, records with no pathway already removed by gather()
))</code></pre>
<p>Add prefix <code>cbd_2014_pathway</code> in case there is a match
with the CBD standard:</p>
<pre class="r"><code>pathway %&lt;&gt;% mutate(mapped_value = case_when(
  cbd_stand != &quot;&quot; ~ paste (&quot;cbd_2014_pathway&quot;, cbd_stand, sep = &quot;:&quot;),
  TRUE ~ &quot;&quot;
))</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>pathway %&gt;%
  select(value, mapped_value) %&gt;%
  group_by(value, mapped_value) %&gt;%
  summarize(records = n()) %&gt;%
  arrange(value) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["value"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mapped_value"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"","2":"","3":"556"},{"1":"agric.","2":"cbd_2014_pathway:escape_agriculture","3":"86"},{"1":"bird seed","2":"cbd_2014_pathway:contaminant_seed","3":"2"},{"1":"birdseed","2":"cbd_2014_pathway:contaminant_seed","3":"31"},{"1":"bulbs","2":"","3":"1"},{"1":"coconut mats","2":"cbd_2014_pathway:contaminant_seed","3":"1"},{"1":"etc.","2":"","3":"2"},{"1":"fish","2":"","3":"3"},{"1":"food refuse","2":"cbd_2014_pathway:escape_food_bait","3":"24"},{"1":"grain","2":"cbd_2014_pathway:contaminant_seed","3":"552"},{"1":"grain (rice)","2":"cbd_2014_pathway:contaminant_seed","3":"4"},{"1":"grass seed","2":"cbd_2014_pathway:contaminant_seed","3":"8"},{"1":"hay","2":"","3":"1"},{"1":"hort","2":"cbd_2014_pathway:escape_horticulture","3":"2"},{"1":"hort.","2":"cbd_2014_pathway:escape_horticulture","3":"1174"},{"1":"hybridization","2":"","3":"52"},{"1":"military troops","2":"","3":"9"},{"1":"nurseries","2":"cbd_2014_pathway:contaminant_nursery","3":"22"},{"1":"ore","2":"cbd_2014_pathway:contaminant_habitat_material","3":"96"},{"1":"pines","2":"cbd_2014_pathway:contaminant_on_plants","3":"4"},{"1":"rice","2":"","3":"2"},{"1":"salt","2":"","3":"2"},{"1":"seeds","2":"cbd_2014_pathway:contaminant_seed","3":"64"},{"1":"timber","2":"cbd_2014_pathway:contaminant_timber","3":"10"},{"1":"tourists","2":"cbd_2014_pathway:stowaway_people_luggage","3":"12"},{"1":"traffic","2":"","3":"4"},{"1":"urban weed","2":"cbd_2014_pathway:stowaway","3":"11"},{"1":"waterfowl","2":"cbd_2014_pathway:contaminant_on_animals","3":"14"},{"1":"wool","2":"cbd_2014_pathway:contaminant_on_animals","3":"566"},{"1":"wool alien","2":"cbd_2014_pathway:contaminant_on_animals","3":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Drop <code>key</code>,<code>value</code> and <code>cbd_stand</code>
column:</p>
<pre class="r"><code>pathway %&lt;&gt;% select(-key, -value, -cbd_stand)</code></pre>
<p>Change column name <code>mapped_value</code> to
<code>description</code>:</p>
<pre class="r"><code>pathway %&lt;&gt;%  rename(description = mapped_value)</code></pre>
<p>Create a <code>type</code> field to indicate the type of
description:</p>
<pre class="r"><code>pathway %&lt;&gt;% mutate (type = &quot;pathway&quot;)</code></pre>
<p>Show pathway descriptions:</p>
<pre class="r"><code>pathway %&gt;% 
  select(description) %&gt;% 
  group_by(description) %&gt;% 
  summarize(records = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["description"],"name":[1],"type":["chr"],"align":["left"]},{"label":["records"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"","2":"632"},{"1":"cbd_2014_pathway:contaminant_habitat_material","2":"96"},{"1":"cbd_2014_pathway:contaminant_nursery","2":"22"},{"1":"cbd_2014_pathway:contaminant_on_animals","2":"581"},{"1":"cbd_2014_pathway:contaminant_on_plants","2":"4"},{"1":"cbd_2014_pathway:contaminant_seed","2":"662"},{"1":"cbd_2014_pathway:contaminant_timber","2":"10"},{"1":"cbd_2014_pathway:escape_agriculture","2":"86"},{"1":"cbd_2014_pathway:escape_food_bait","2":"24"},{"1":"cbd_2014_pathway:escape_horticulture","2":"1176"},{"1":"cbd_2014_pathway:stowaway","2":"11"},{"1":"cbd_2014_pathway:stowaway_people_luggage","2":"12"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Keep only non-empty descriptions:</p>
<pre class="r"><code>pathway %&lt;&gt;% filter(!is.na(description) &amp; description != &quot;&quot;)</code></pre>
</div>
<div id="degree-of-establishment" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Degree of
establishment</h3>
<p>Create separate dataframe:</p>
<pre class="r"><code>degree_of_establishment &lt;- input_data</code></pre>
<p>The information for degree of establishment is contained in
<code>d_n</code>:</p>
<pre class="r"><code>degree_of_establishment %&gt;%
  select(d_n) %&gt;%
  group_by_all() %&gt;%
  summarize(records = n()) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["d_n"],"name":[1],"type":["chr"],"align":["left"]},{"label":["records"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Cas.","2":"1899"},{"1":"Cas.?","2":"51"},{"1":"Ext.","2":"15"},{"1":"Ext./Cas.","2":"4"},{"1":"Ext.?","2":"4"},{"1":"Inv.","2":"64"},{"1":"Nat.","2":"477"},{"1":"Nat.?","2":"102"},{"1":"NA","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Clean the data:</p>
<pre class="r"><code>degree_of_establishment %&lt;&gt;% mutate(description = recode(d_n,
  &quot;Ext.?&quot; = &quot;Ext.&quot;,
  &quot;Cas.?&quot; = &quot;Cas.&quot;,
  &quot;Nat.?&quot; = &quot;Nat.&quot;,
  .missing = &quot;&quot;
))</code></pre>
<p>We decided to use the unified framework for biological invasions of
<a href="http://doc.rero.ch/record/24725/files/bach_puf.pdf">Blackburn
et al. 2011</a> for <code>invasion stage</code>. <code>casual</code>,
<code>naturalized</code> and <code>invasive</code> are terms included in
this framework. However, we decided to discard the terms
<code>naturalized</code> and <code>invasive</code> listed in Blackburn
et al. (see trias-project/alien-fishes-checklist#6 (comment)). So,
<code>naturalized</code> and <code>invasive</code> are replaced by
<code>established</code>. For <code>extinct</code> (introduced taxa that
once were naturalized but that have not been confirmed in recent times)
and <code>extinct/casual</code> species (taxa are no longer considered
as naturalized but still occur as casuals), we map the most recent
invasion stage (i.e. <code>extinct</code> and <code>casual</code>
respectively):</p>
<pre class="r"><code>degree_of_establishment %&lt;&gt;% mutate(description = recode(description,
  &quot;Cas.&quot; = &quot;casual&quot;,
  &quot;Inv.&quot; = &quot;established&quot;,
  &quot;Nat.&quot; = &quot;established&quot;,
  &quot;Ext.&quot; = &quot;extinct&quot;,
  &quot;Ext./Cas.&quot; = &quot;casual&quot;
))</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>degree_of_establishment %&gt;%
  select(d_n, description) %&gt;%
  group_by_all() %&gt;%
  summarize(records = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["d_n"],"name":[1],"type":["chr"],"align":["left"]},{"label":["description"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"Cas.","2":"casual","3":"1899"},{"1":"Cas.?","2":"casual","3":"51"},{"1":"Ext.","2":"extinct","3":"15"},{"1":"Ext./Cas.","2":"casual","3":"4"},{"1":"Ext.?","2":"extinct","3":"4"},{"1":"Inv.","2":"established","3":"64"},{"1":"Nat.","2":"established","3":"477"},{"1":"Nat.?","2":"established","3":"102"},{"1":"NA","2":"","3":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Create a <code>type</code> field to indicate the type of
description:</p>
<pre class="r"><code>degree_of_establishment %&lt;&gt;% mutate(type = &quot;degree of establishment&quot;)</code></pre>
<p>Union native range, pathway of introduction and degree of
establishment:</p>
<pre class="r"><code>description &lt;- bind_rows(native_range, pathway, degree_of_establishment)</code></pre>
<p>Map the data to <a
href="http://rs.gbif.org/extension/gbif/1.0/description.xml">Taxon
Description</a>:</p>
</div>
<div id="taxonid-3" class="section level3" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> taxonID</h3>
<pre class="r"><code>description %&lt;&gt;% mutate(dwc_taxonID = taxon_id)</code></pre>
</div>
<div id="description" class="section level3" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> description</h3>
<pre class="r"><code>description %&lt;&gt;% mutate(dwc_description = description)</code></pre>
</div>
<div id="type" class="section level3" number="3.4.6">
<h3><span class="header-section-number">3.4.6</span> type</h3>
<pre class="r"><code>description %&lt;&gt;% mutate(dwc_type = type)</code></pre>
</div>
<div id="language-1" class="section level3" number="3.4.7">
<h3><span class="header-section-number">3.4.7</span> language</h3>
<pre class="r"><code>description %&lt;&gt;% mutate(dwc_language = &quot;en&quot;)</code></pre>
</div>
</div>
</div>
<div id="post-processing" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Post-processing</h1>
<p>Remove the original columns for each of the generated files:</p>
<pre class="r"><code>taxon %&lt;&gt;% select(starts_with(&quot;dwc_&quot;)) 
distribution %&lt;&gt;% select(starts_with(&quot;dwc_&quot;)) 
species_profile %&lt;&gt;% select(starts_with(&quot;dwc_&quot;)) 
description %&lt;&gt;% select(starts_with(&quot;dwc_&quot;))</code></pre>
<p>Drop the <code>dwc_</code> prefix:</p>
<pre class="r"><code>colnames(taxon) &lt;- str_remove(colnames(taxon), &quot;dwc_&quot;)
colnames(distribution) &lt;- str_remove(colnames(distribution), &quot;dwc_&quot;)
colnames(species_profile) &lt;- str_remove(colnames(species_profile), &quot;dwc_&quot;)
colnames(description) &lt;- str_remove(colnames(description), &quot;dwc_&quot;)</code></pre>
<p>Sort on <code>taxonID</code> to group description information per
taxon:</p>
<pre class="r"><code>taxon %&lt;&gt;% arrange(taxonID)
distribution %&lt;&gt;% arrange(taxonID)
species_profile %&lt;&gt;% arrange(taxonID)
description %&lt;&gt;% arrange(taxonID)</code></pre>
<p>Preview taxon core:</p>
<pre class="r"><code>taxon %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["language"],"name":[1],"type":["chr"],"align":["left"]},{"label":["license"],"name":[2],"type":["chr"],"align":["left"]},{"label":["rightsHolder"],"name":[3],"type":["chr"],"align":["left"]},{"label":["datasetID"],"name":[4],"type":["chr"],"align":["left"]},{"label":["datasetName"],"name":[5],"type":["chr"],"align":["left"]},{"label":["taxonID"],"name":[6],"type":["chr"],"align":["left"]},{"label":["scientificNameID"],"name":[7],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[8],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[9],"type":["chr"],"align":["left"]},{"label":["family"],"name":[10],"type":["chr"],"align":["left"]},{"label":["taxonRank"],"name":[11],"type":["chr"],"align":["left"]},{"label":["nomenclaturalCode"],"name":[12],"type":["chr"],"align":["left"]}],"data":[{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","7":"http://ipni.org/urn:lsid:ipni.org:names:173972-1","8":"Achillea filipendulina Lam.","9":"Plantae","10":"Asteraceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","7":"NA","8":"Cotoneaster coriaceus Franch. (incl. C. lacteus W.W. Smith)","9":"Plantae","10":"Rosaceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","7":"http://ipni.org/urn:lsid:ipni.org:names:801630-1","8":"Collinsia heterophylla Buist ex Graham","9":"Plantae","10":"Plantaginaceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:0057c474d19804c969845b5697f69148","7":"NA","8":"Campanula portenschlagiana Schult.","9":"Plantae","10":"Campanulaceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:0063fb918750e3db0f1bb551cd9587c5","7":"http://ipni.org/urn:lsid:ipni.org:names:249267-1","8":"Sinacalia tangutica (Maxim.) R. Nordenstam","9":"Plantae","10":"Asteraceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:0068d529c19ee42ce7ea09fc427d82e4","7":"http://ipni.org/urn:lsid:ipni.org:names:261839-1","8":"Chamaecyparis lawsoniana (A.Murray) Parl.","9":"Plantae","10":"Cupressaceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:0082238f42c319a14b46e966082002a4","7":"http://ipni.org/urn:lsid:ipni.org:names:979521-1","8":"Eleusine coracana subsp. africana (Kennedy-O’Byrne) Hilu & de Wet","9":"Plantae","10":"Poaceae","11":"subspecies","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:008e914a35deab07270b333c73bfba14","7":"NA","8":"Arabidopsis arenosa (L.) Lawalrée subsp. arenosa","9":"Plantae","10":"Brassicaceae","11":"subspecies","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:00bb2bc05d9481b0bc8b5b57117fa799","7":"http://ipni.org/urn:lsid:ipni.org:names:70029022-1","8":"Galatella sedifolia (L.) Greuter","9":"Plantae","10":"Asteraceae","11":"species","12":"ICN"},{"1":"en","2":"http://creativecommons.org/publicdomain/zero/1.0/","3":"Botanic Garden Meise","4":"https://doi.org/10.15468/wtda1m","5":"Manual of the Alien Plants of Belgium","6":"alien-plants-belgium:taxon:00bff53bc6ed2a1d60d89bc060abba2f","7":"http://ipni.org/urn:lsid:ipni.org:names:722420-1","8":"Cotoneaster ascendens Flinck & B. Hylmö","9":"Plantae","10":"Rosaceae","11":"species","12":"ICN"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Preview distribution extension:</p>
<pre class="r"><code>distribution %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["locationID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["locality"],"name":[3],"type":["chr"],"align":["left"]},{"label":["countryCode"],"name":[4],"type":["chr"],"align":["left"]},{"label":["occurrenceStatus"],"name":[5],"type":["chr"],"align":["left"]},{"label":["establishmentMeans"],"name":[6],"type":["chr"],"align":["left"]},{"label":["eventDate"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"ISO_3166-2:BE-VLG","3":"Flemish Region","4":"BE","5":"present","6":"introduced","7":""},{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"ISO_3166-2:BE-WAL","3":"Walloon Region","4":"BE","5":"present","6":"introduced","7":""},{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"ISO_3166-2:BE-BRU","3":"Brussels-Capital Region","4":"BE","5":"present","6":"introduced","7":""},{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"ISO_3166-2:BE","3":"Belgium","4":"BE","5":"present","6":"introduced","7":"1944/2018"},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"ISO_3166-2:BE-VLG","3":"Flemish Region","4":"BE","5":"present","6":"introduced","7":""},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"ISO_3166-2:BE-WAL","3":"Walloon Region","4":"BE","5":"present","6":"introduced","7":""},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"ISO_3166-2:BE","3":"Belgium","4":"BE","5":"present","6":"introduced","7":"2010/2018"},{"1":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","2":"ISO_3166-2:BE-VLG","3":"Flemish Region","4":"BE","5":"present","6":"introduced","7":"2000/2018"},{"1":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","2":"ISO_3166-2:BE","3":"Belgium","4":"BE","5":"present","6":"introduced","7":"2000/2018"},{"1":"alien-plants-belgium:taxon:0057c474d19804c969845b5697f69148","2":"ISO_3166-2:BE-VLG","3":"Flemish Region","4":"BE","5":"present","6":"introduced","7":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Preview species profile extension:</p>
<pre class="r"><code>species_profile %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["isMarine"],"name":[2],"type":["chr"],"align":["left"]},{"label":["isFreshwater"],"name":[3],"type":["chr"],"align":["left"]},{"label":["isTerrestrial"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:0057c474d19804c969845b5697f69148","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:0063fb918750e3db0f1bb551cd9587c5","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:0068d529c19ee42ce7ea09fc427d82e4","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:0082238f42c319a14b46e966082002a4","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:008e914a35deab07270b333c73bfba14","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:00bb2bc05d9481b0bc8b5b57117fa799","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"alien-plants-belgium:taxon:00bff53bc6ed2a1d60d89bc060abba2f","2":"FALSE","3":"FALSE","4":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Preview description extension:</p>
<pre class="r"><code>description %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["description"],"name":[2],"type":["chr"],"align":["left"]},{"label":["type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["language"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"temperate Asia (WGSRPD:3)","3":"native range","4":"en"},{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"cbd_2014_pathway:escape_horticulture","3":"pathway","4":"en"},{"1":"alien-plants-belgium:taxon:0005624db3a63ca28d63626bbe47e520","2":"casual","3":"degree of establishment","4":"en"},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"temperate Asia (WGSRPD:3)","3":"native range","4":"en"},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"cbd_2014_pathway:escape_horticulture","3":"pathway","4":"en"},{"1":"alien-plants-belgium:taxon:0046a7ee2325ad057382bd9fd726cef9","2":"casual","3":"degree of establishment","4":"en"},{"1":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","2":"Northern America (WGSRPD:7)","3":"native range","4":"en"},{"1":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","2":"cbd_2014_pathway:escape_horticulture","3":"pathway","4":"en"},{"1":"alien-plants-belgium:taxon:004f8d63026942a6baf80b67b6d40b98","2":"casual","3":"degree of establishment","4":"en"},{"1":"alien-plants-belgium:taxon:0057c474d19804c969845b5697f69148","2":"Europe (WGSRPD:1)","3":"native range","4":"en"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Save to CSV:</p>
<pre class="r"><code>write_csv(taxon, here(&quot;data&quot;, &quot;processed&quot;, &quot;taxon.csv&quot;), na = &quot;&quot;)
write_csv(distribution, here(&quot;data&quot;, &quot;processed&quot;, &quot;distribution.csv&quot;), na = &quot;&quot;)
write_csv(species_profile, here(&quot;data&quot;, &quot;processed&quot;, &quot;speciesprofile.csv&quot;), na = &quot;&quot;)
write_csv(description, here(&quot;data&quot;, &quot;processed&quot;, &quot;description.csv&quot;), na = &quot;&quot;)</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
